@using System.IO
@model IEnumerable<DataVault.Models.Files>
@{
    ViewData["Title"] = "Principal";
    Layout = null;

    // Pega o nome do cliente da sessão, se existir
    var nomeCliente = Context.Session.GetString("NomeCliente") ?? "Usuário";
}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>@ViewData["Title"]</title>
    <link rel="stylesheet" href="~/css/Principal.css" />
    <link href="https://fonts.googleapis.com/css2?family=Montserrat&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
</head>
<body>
    <header>
        <div id="linha1">
            <div id="Empresa">
                <div><img src="~/imagens/logo.png" alt="Logo" id="Logo"></div>
                <div id="nomeEmpresa"><h3>DataVault</h3></div>
            </div>

            <div id="pesquisa">
                <form asp-controller="Files" asp-action="Search" method="post">
                    <div id="lupa">
                        <i class="fa-solid fa-magnifying-glass" id="lupinha"></i>
                        <input type="search" name="Procura" id="input_procurar" placeholder="Pesquise aqui" />
                    </div>
                </form>
            </div>

            <div id="tres_icones">
                <div id="premium"><i class="fa-solid fa-gem"></i></div>
                <div id="configuracoes">
                    <a asp-controller="Home" asp-action="Configuracoes"><i class="fa-solid fa-gear"></i></a>
                </div>
                <div id="perfil"><i class="fa-solid fa-user"></i></div>
            </div>
        </div>

        <div id="linha2">
            <div id="nome_cliente">
                <h3>@nomeCliente</h3>
            </div>
            <ul id="lista_tipos">
                <li><h3>Recentes</h3></li>
                <li><h3>PDF</h3></li>
                <li><h3>Excel</h3></li>
                <li><h3>JPG</h3></li>
                <li><h3>PNG</h3></li>
                <li><h3>WORD</h3></li>
                <li><h3>Outros</h3></li>
            </ul>
        </div>
    </header>

    <div id="separar_dois">
        <nav>
            <div id="carregar">
                <h2 id="texto_carregar">
                    <i class="fa-solid fa-upload" id="icone_baixar"></i>
                    <span id="br_direita">Carregar</span>
                </h2>
                <form asp-controller="Files" asp-action="Upload" method="post" enctype="multipart/form-data" class="form-upload">
                    <input id="pular" type="file" name="arquivo" accept=".pdf,.pptx,.docx,.word,.xml,.png,.jpg,.sql" />
                </form>
            </div>

            <div id="lista_funcoes">
                <ul id="ul_funcoes">
                    <li id="pastas"><i class="fa-solid fa-folder"></i><div>Pastas</div></li>
                    <li id="favoritos"><i class="fa-solid fa-star"></i><div>Favoritos</div></li>
                    <li id="Compartilhados"><i class="fa-solid fa-share-nodes"></i><div>Compartilhados</div></li>
                    <li id="Lixeira"><i class="fa-solid fa-trash"></i><div>Lixeira</div></li>
                    <li id="deutrabalho"><i class="fa-solid fa-cloud"></i><div id="diminui_arma">Armazenamento</div></li>
                    <div id="memoria">5GB de 25GB</div>
                </ul>
            </div>
        </nav>

        <main>
            @if (Model != null && Model.Any())
            {
                <div class="arquivos-lista">
                    @foreach (var file in Model)
                    {
                        <div class="arquivo-item">
                            <i class="fa-regular fa-file"></i>
                            <span>@file.NomeArquivo</span>
                            <a asp-controller="Files" asp-action="DownloadByName" asp-route-fileName="@file.NomeArquivo" class="btn-download">
                                <i class="fa-solid fa-download"></i>
                            </a>
                        </div>
                    }
                </div>
            }
            else
            {
                <p>Nenhum arquivo encontrado.</p>
            }
        </main>
    </div>

    <script>
        const inputArquivo = document.querySelector('#pular');
        const form = document.querySelector('.form-upload');

        inputArquivo.addEventListener('change', () => {
            const formData = new FormData(form);

            fetch('/Files/Upload', {
                method: 'POST',
                body: formData
            })
                .then(response => response.text())
                .then(result => {
                    alert(result);
                    location.reload();
                })
                .catch(error => alert('Erro ao enviar arquivo: ' + error));
        });
    </script>
</body>
</html>